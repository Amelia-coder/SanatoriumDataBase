<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Edit Client</title>
</head>
<body>
<h1>Edit Client</h1>
<form th:action="@{/clients/update/{id}(id=${client.id})}" method="post" th:object="${client}">
  <label>First Name:</label>
  <input type="text" th:field="*{firstName}" /><br />
  <label>Last Name:</label>
  <input type="text" th:field="*{lastName}" /><br />
  <label>Phone:</label>
  <input type="text" th:field="*{phone}" /><br />
  <label>Email:</label>
  <input type="email" th:field="*{email}" /><br />
  <input class="hiddenId" type="hidden" th:field="*{id}" />
  <button type="submit">Update</button>
  <script>

    document.addEventListener('DOMContentLoaded', () => {
      // Форма для добавления клиента
      const form = document.querySelector('form');


      // Обработка отправки формы
      form.addEventListener('submit', async (event) => {
        event.preventDefault(); // Предотвращаем стандартное поведение отправки формы

        // Сбор данных формы

        const formData = new FormData(form);
        const clientData = {};
        formData.forEach((value, key) => {
          clientData[key] = value;
        });

        clientData['id'] = form.querySelector('[name="id"]').value;

        try {
          // Отправка данных на сервер
          const queryString = '/clients/update';
          const response = await fetch(queryString, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(clientData),
          });

          if (response.ok) {
            alert('Client data successfully updated!');
            form.reset();
          } else {
            const error = await response.json();
            console.error('Ошибка добавления клиента: ', error);
            alert('Failed to updated client: ' + error.message || 'Unknown error');
          }
        } catch (error) {
          console.error('Ошибка при отправке запроса:', error);
          alert('An error occurred while adding the client.');
        }
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</form>
</body>
</html>
